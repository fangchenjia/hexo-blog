---
title: 同源与跨域
toc: true
comments: true
tags:
  - JavaScript
  - ajax
categories:
  - JavaScript
description:
  - 两个不同源的网站之间可以相互请求数据，需要使用到跨域 。
keywords:
  - 同源
  - 跨域
  - jsonp
abbrlink: bf54b5a0
date: 2020-12-18 15:53:49
updated: 2020-12-18 15:53:49
---

# 同源与跨域

## 同源

不同源 则跨域

<!-- more -->

### 同源策略的基本概念

> 1995 年，同源政策由 Netscape 公司引入浏览器。目前，所有浏览器都实行这个政策。
> 同源策略：最初，它的含义是指，A 网页设置的 Cookie，B 网页不能打开，除非这两个网页"同源"。现在浏览器的所谓"同源"指的是"三个相同":

```javascript
协议相同;
域名相同;
端口相同;
```

举例来说，`http://www.example.com/dir/page.html`这个网址，协议是`http://`，域名是`www.example.com`，端口是`80`（默认端口可以省略）。它的同源情况如下。

```javascript
//http://www.example.com/dir2/other.html：同源
//http://example.com/dir/other.html：不同源（域名不同）
//http://v2.www.example.com/dir/other.html：不同源（域名不同）
//http://www.example.com:81/dir/other.html：不同源（端口不同）
```

### 同源策略的目的

> 同源政策的目的，是为了保证用户信息的安全，防止恶意的网站窃取数据。

### 同源策略的限制范围

> 随着互联网的发展，“同源策略”越来越严格，目前，如果非同源，以下三种行为都将收到限制。

```javascript
//1. Cookie、LocalStorage 无法读取。
//2. DOM 无法获得。
//3. AJAX 请求不能发送。
```

虽然这些限制是很有必要的，但是也给我们日常开发带来不好的影响。比如实际开发过程中，往往都会把服务器端架设到一台甚至是一个集群的服务器中，把客户端页面放到另外一个单独的服务器。那么这时候就会出现不同源的情况，如果我们知道两个网站都是安全的话，我们是希望两个不同源的网站之间可以相互请求数据的。这就需要使用到**跨域** 。

## 跨域

### jsonp

> JSONP(JSON with Padding)、可用于解决主流浏览器的跨域数据访问的问题。原理：服务端返回一个预先定义好的 javascript 函数的调用，并且将服务器的数据以该函数参数的形式传递过来，这个方法需要前后端配合。

`script`  标签是不受同源策略的限制的，它可以载入任意地方的 JavaScript 文件，而并不要求同源。类似的还有`img`和`link`标签

```html
<!--不受同源策略的标签-->
<img src="http://www.api.com/1.jpg" alt="" />
<link rel="stylesheet" href="http://www.api.com/1.css" />
<script src="http://www.api.com/1.js"></script>
```

### jquery 对于 jsonp 的封装

```javascript
//使用起来相当的简单，跟普通的get请求没有任何的区别，只需要把dataType固定成jsonp即可。
$.ajax({
  type: "get",
  url: "http://www.api.com/testjs.php",
  dataType: "jsonp",
  data: {
    uname: "hucc",
    upass: "123456",
  },
  success: function (info) {
    console.log(info);
  },
});
```

#### jsonp 实现的步骤：

```
1- 前端先定义好一个方法， 利用script的src属性 把方法名传递给后台
2- 后台获取前端传递方法名，在方法名后面拼(),在()中添加json数据
3- 后台返回填充好数据的方法的调用 say({"name":"zs"});
4- 前端接收到后台返回后会立即执行，即可获取后台返回的数据

注意：
1- jsonp 只能发送get请求
2- jsonp 需要前后端配合完成
```
